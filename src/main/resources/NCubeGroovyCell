import com.cedarsoftware.ncube.exception.RuleStop

/**
 * Base class for all GroovyExpression and GroovyMethod's within n-cube CommandCells.
 * @see com.cedarsoftware.ncube.GroovyBase
 */
class NCubeGroovyCell
{
    def input;
    def output;
    def stack;
    def ncube;
    def ncubeMgr;

    NCubeGroovyCell(Map args)
    {
        input = args.input;
        output = args.output;
        stack = args.stack;
        ncube = args.ncube;
        ncubeMgr = args.ncubeMgr;
    }

    def getFixedCell(String name, Map coord)
    {
        if (ncubeMgr.getCube(name) == null)
        {
            throw new IllegalArgumentException('NCube "' + ncube + '" not loaded into NCubeManager, attempting fixed ($) reference to cell: ' + coord.toString());
        }
        return ncubeMgr.getCube(name).getCell(coord, output);
    }

    def getRelativeCell(Map coord)
    {
        input.putAll(coord);
        return ncube.getCell(input, output);
    }

    def getRelativeCubeCell(String name, Map coord)
    {
        input.putAll(coord);
        if (ncubeMgr.getCube(name) == null)
        {
            throw new IllegalArgumentException('NCube "' + ncube + '" not loaded into NCubeManager, attempting relative (@) reference to cell: ' + coord.toString());
        }
        return ncubeMgr.getCube(name).getCell(input, output);
    }

    void ruleStop()
    {
        throw new RuleStop();
    }

    def run()
    {
        throw new IllegalStateException("This method should be overridden");
    }
}